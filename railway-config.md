# Конфигурация для развертывания на Railway

## Переменные окружения

Создайте следующие переменные окружения в Railway:

### База данных
```
DATABASE_URL=postgresql://username:password@host:port/database
POSTGRES_USER=thehotpotspot
POSTGRES_PASSWORD=your_secure_password
POSTGRES_DB=thehotpotspot
```

### Сервер
```
PORT=3000
HOST=0.0.0.0
RUST_LOG=info
```

### Безопасность
```
JWT_SECRET=your_jwt_secret_key_here
ENCRYPTION_KEY=your_encryption_key_here
```

### Внешние сервисы
```
TWITCH_CLIENT_ID=your_twitch_client_id
TWITCH_CLIENT_SECRET=your_twitch_client_secret
YOUTUBE_API_KEY=your_youtube_api_key
```

### Блокчейн
```
BLOCKCHAIN_NETWORK=mainnet
MIN_CONFIRMATIONS=3
GAS_PRICE=20
```

### Токеномика
```
ST_PER_GEL=0.2
UT_PER_STREAMING_SESSION=1
UT_PER_2_HOURS_VIEWING=1
UT_PER_FIFTH_VISIT=1
UT_PER_POPULAR_COMMENT=1
UT_PER_REPOST=1
```

### Мониторинг
```
ENABLE_METRICS=true
METRICS_PORT=9090
```

## Инструкции по развертыванию

### 1. Подготовка проекта
- Убедитесь, что все файлы загружены в GitHub
- Проверьте, что проект компилируется: `cargo build --release`

### 2. Создание проекта в Railway
1. Зайдите на [railway.app](https://railway.app)
2. Войдите через GitHub
3. Нажмите "New Project"
4. Выберите "Deploy from GitHub repo"
5. Выберите репозиторий `thehotpotspot`

### 3. Настройка базы данных
1. В Railway добавьте PostgreSQL сервис
2. Скопируйте DATABASE_URL из настроек PostgreSQL
3. Добавьте переменную окружения DATABASE_URL

### 4. Настройка переменных окружения
1. Перейдите в Settings → Variables
2. Добавьте все переменные из списка выше
3. Установите соответствующие значения

### 5. Развертывание
1. Railway автоматически начнет сборку при push в main ветку
2. Следите за логами сборки
3. После успешной сборки приложение будет доступно по URL

### 6. Проверка развертывания
1. Откройте URL приложения
2. Проверьте основные эндпоинты:
   - `/` - главная страница
   - `/api/health` - проверка здоровья
   - `/api/menu` - получение меню

## Мониторинг и логи

### Просмотр логов
- В Railway перейдите в раздел "Deployments"
- Выберите последний деплой
- Просмотрите логи в реальном времени

### Метрики
- Приложение экспортирует метрики на порту 9090
- Используйте Prometheus для сбора метрик
- Настройте алерты в Grafana

## Масштабирование

### Горизонтальное масштабирование
1. В Railway увеличьте количество реплик
2. Настройте load balancer
3. Убедитесь, что база данных поддерживает множественные подключения

### Вертикальное масштабирование
1. Увеличьте ресурсы контейнера
2. Мониторьте использование CPU и памяти
3. Оптимизируйте код при необходимости

## Резервное копирование

### База данных
- Настройте автоматические бэкапы PostgreSQL
- Храните бэкапы в отдельном хранилище
- Тестируйте восстановление из бэкапов

### Конфигурация
- Версионируйте все изменения конфигурации
- Документируйте все переменные окружения
- Создайте план восстановления

## Безопасность

### SSL/TLS
- Railway автоматически предоставляет SSL сертификаты
- Убедитесь, что все соединения используют HTTPS

### Секреты
- Никогда не коммитьте секреты в код
- Используйте переменные окружения для всех секретов
- Регулярно ротируйте ключи и пароли

### Мониторинг безопасности
- Настройте алерты на подозрительную активность
- Мониторьте логи на предмет ошибок аутентификации
- Регулярно обновляйте зависимости

## Поддержка

### Логи и отладка
- Используйте структурированное логирование
- Настройте разные уровни логирования для разных окружений
- Сохраняйте логи для анализа

### Обновления
- Используйте blue-green deployment для обновлений
- Тестируйте обновления в staging окружении
- Имейте план отката для каждого обновления
