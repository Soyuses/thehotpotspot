<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Дашборд владельца сети</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            padding: 30px;
            background: #f8f9fa;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .stat-card h3 {
            color: #333;
            margin-bottom: 10px;
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #ff6b6b;
        }

        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
            overflow-x: auto;
        }

        .tab {
            padding: 20px;
            text-align: center;
            cursor: pointer;
            background: #f8f9fa;
            border: none;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            white-space: nowrap;
            min-width: 150px;
        }

        .tab:hover {
            background: #e9ecef;
        }

        .tab.active {
            background: white;
            border-bottom: 3px solid #ff6b6b;
            color: #ff6b6b;
        }

        .tab-content {
            display: none;
            padding: 30px;
        }

        .tab-content.active {
            display: block;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            border: 1px solid #dee2e6;
        }

        .card h3 {
            color: #333;
            margin-bottom: 15px;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .alert.critical {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .alert.high {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .alert.medium {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .alert.low {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        /* Стили для соотношения токенов */
        .token-ratio-display {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
        }

        .ratio-item {
            text-align: center;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #e9ecef;
            min-width: 150px;
        }

        .ratio-item h4 {
            color: #333;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .ratio-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #ff6b6b;
            margin-bottom: 5px;
        }

        .ratio-percentage {
            color: #666;
            font-size: 0.9em;
        }

        .ratio-separator {
            font-size: 2em;
            font-weight: bold;
            color: #333;
        }

        /* Стили для учета затрат */
        .cost-summary {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .cost-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #ff6b6b;
        }

        .cost-item.total {
            background: #e3f2fd;
            border-left-color: #2196f3;
            font-weight: bold;
            font-size: 1.1em;
        }

        .cost-label {
            font-weight: 500;
            color: #333;
        }

        .cost-value {
            font-weight: bold;
            color: #ff6b6b;
        }

        .token-calculation {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .calculation-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .calculation-item.result {
            background: #e8f5e8;
            border: 2px solid #4caf50;
            font-weight: bold;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .cost-history {
            overflow-x: auto;
        }

        .cost-history table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .cost-history th,
        .cost-history td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #dee2e6;
        }

        .cost-history th {
            background: #f8f9fa;
            font-weight: 600;
            color: #495057;
        }

        .cost-history tr:hover {
            background: #f8f9fa;
        }

        .transparency-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .transparency-item {
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #28a745;
        }

        .transparency-item h4 {
            color: #28a745;
            margin-bottom: 10px;
        }

        .transparency-item p {
            color: #666;
            margin-bottom: 15px;
        }

        .ratio-info {
            text-align: center;
            background: #e3f2fd;
            border: 1px solid #bbdefb;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }

        .ratio-info p {
            margin: 5px 0;
        }

        .ratio-info strong {
            color: #1976d2;
        }

        .btn {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6c757d, #495057);
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .table th,
        .table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #dee2e6;
        }

        .table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #333;
        }

        .table tr:hover {
            background: #f8f9fa;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #ff6b6b;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            transition: width 0.3s ease;
        }

        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-safe {
            background: #d4edda;
            color: #155724;
        }

        .status-warning {
            background: #fff3cd;
            color: #856404;
        }

        .status-danger {
            background: #f8d7da;
            color: #721c24;
        }

        /* Стили для правил токеномики */
        .tokenomics-rules {
            display: grid;
            gap: 20px;
        }

        .rule-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #ff6b6b;
        }

        .rule-section h4 {
            margin: 0 0 15px 0;
            color: #333;
            font-size: 1.1em;
        }

        .rule-section ul {
            margin: 0;
            padding-left: 20px;
        }

        /* Стили для секции конвертации */
        .conversion-section {
            display: grid;
            gap: 20px;
        }

        .ut-holders-list {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 10px;
            background: #f8f9fa;
        }

        .ut-holder-item {
            display: flex;
            align-items: center;
            padding: 8px;
            border-bottom: 1px solid #eee;
        }

        .ut-holder-item:last-child {
            border-bottom: none;
        }

        .ut-holder-item input[type="checkbox"] {
            margin-right: 10px;
        }

        .ut-holder-item label {
            flex: 1;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .ut-balance {
            font-weight: bold;
            color: #28a745;
        }

        .exchange-rate {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .exchange-rate input {
            width: 100px;
        }

        .conversion-summary {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #2196f3;
        }

        .conversion-summary h4 {
            margin: 0 0 10px 0;
            color: #1976d2;
        }

        .conversion-item {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px solid #bbdefb;
        }

        .conversion-item:last-child {
            border-bottom: none;
            font-weight: bold;
            color: #1976d2;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%);
        }

        .btn-primary:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
            border: none;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .rule-section li {
            margin: 8px 0;
            line-height: 1.5;
        }

        .rule-section strong {
            color: #ff6b6b;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>👑 Дашборд владельца сети</h1>
            <p>Мониторинг и управление блокчейн сетью фудтраков</p>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <h3>Security Tokens</h3>
                <div class="stat-value" id="ownerTokens">0.00</div>
            </div>
            <div class="stat-card">
                <h3>Utility Tokens</h3>
                <div class="stat-value" id="ownerUtilityTokens">0.00</div>
            </div>
            <div class="stat-card">
                <h3>Процент владения</h3>
                <div class="stat-value" id="ownerPercentage">0.00%</div>
            </div>
            <div class="stat-card">
                <h3>Активные алерты</h3>
                <div class="stat-value" id="activeAlerts">0</div>
            </div>
            <div class="stat-card">
                <h3>Франшизные ноды</h3>
                <div class="stat-value" id="franchiseNodes">0</div>
            </div>
            <div class="stat-card">
                <h3>Благотворительный фонд</h3>
                <div class="stat-value" id="charityFund">0.00</div>
            </div>
            <div class="stat-card">
                <h3>Невостребованные токены</h3>
                <div class="stat-value" id="unclaimedTokens">0.00</div>
            </div>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showTab('monitoring')">Мониторинг</button>
            <button class="tab" onclick="showTab('franchises')">Франшизы</button>
            <button class="tab" onclick="showTab('token-emission')">Эмиссия токенов</button>
            <button class="tab" onclick="showTab('cost-accounting')">Учет затрат</button>
            <button class="tab" onclick="showTab('streams')">Управление стримами</button>
            <button class="tab" onclick="showTab('image-management')">Управление изображениями</button>
            <button class="tab" onclick="showTab('unclaimed')">Невостребованные</button>
            <button class="tab" onclick="showTab('security')">Безопасность</button>
        </div>

        <!-- Мониторинг -->
        <div id="monitoring" class="tab-content active">
            <h2>Мониторинг системы</h2>
            
            <div class="grid">
                <div class="card">
                    <h3>Распределение токенов</h3>
                    <div id="tokenDistribution">
                        <div class="progress-bar">
                            <div class="progress-fill" id="ownerProgress" style="width: 48%"></div>
                        </div>
                        <p>Владелец: <span id="ownerTokensPercent">48.00%</span></p>
                        
                        <div class="progress-bar">
                            <div class="progress-fill" id="charityProgress" style="width: 3%; background: #28a745;"></div>
                        </div>
                        <p>Благотворительный фонд: <span id="charityTokensPercent">3.00%</span></p>
                        
                        <div class="progress-bar">
                            <div class="progress-fill" id="othersProgress" style="width: 49%; background: #17a2b8;"></div>
                        </div>
                        <p>Остальные: <span id="othersTokensPercent">49.00%</span></p>
                    </div>
                </div>

                <div class="card">
                    <h3>Токеномика системы</h3>
                    <div id="tokenRatio">
                        <div class="token-ratio-display">
                            <div class="ratio-item">
                                <h4>Security Tokens (ST)</h4>
                                <div class="ratio-value" id="securityTokensCount">0</div>
                                <div class="ratio-percentage">Генерируются за продажи</div>
                            </div>
                            <div class="ratio-separator">≠</div>
                            <div class="ratio-item">
                                <h4>Utility Tokens (SPOT)</h4>
                                <div class="ratio-value" id="utilityTokensCount">0</div>
                                <div class="ratio-percentage">Генерируются за активность</div>
                            </div>
                        </div>
                        <div class="ratio-info">
                            <p><strong>Новая токеномика:</strong></p>
                            <p><strong>ST (Security Tokens):</strong> Только за продажи (1 GEL = 0.2 ST)</p>
                            <p><strong>UT (Utility Tokens - SPOT):</strong> Только за активность</p>
                            <ul style="text-align: left; margin: 10px 0;">
                                <li>1 SPOT за каждое 5-е посещение</li>
                                <li>1 SPOT за 2 часа просмотра стримов</li>
                                <li>1 SPOT за репост/комментарий с 50+ лайками</li>
                                <li>1 SPOT за сессию стриминга (макс. 45 мин)</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h3>Активные алерты</h3>
                    <div id="alertsList">
                        <p>Загрузка алертов...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Франшизы -->
        <div id="franchises" class="tab-content">
            <h2>Управление франшизами</h2>
            
            <div class="grid">
                <div class="card">
                    <h3>Добавить франшизную ноду</h3>
                    <form id="franchiseForm">
                        <div class="form-group">
                            <label>ID ноды:</label>
                            <input type="text" id="nodeId" required>
                        </div>
                        <div class="form-group">
                            <label>Адрес владельца франшизы:</label>
                            <input type="text" id="franchiseOwner" required>
                        </div>
                        <button type="submit" class="btn">Добавить франшизу</button>
                    </form>
                </div>

                <div class="card">
                    <h3>Список франшиз</h3>
                    <div id="franchisesList">
                        <p>Загрузка франшиз...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Эмиссия токенов -->
        <div id="token-emission" class="tab-content">
            <h2>Управление токеномикой</h2>
            
            <div class="card">
                <h3>📊 Правила генерации токенов</h3>
                <div class="tokenomics-rules">
                    <div class="rule-section">
                        <h4>🔒 Security Tokens (ST) - Только за продажи</h4>
                        <ul>
                            <li><strong>1 GEL = 0.2 ST</strong> - за каждую покупку</li>
                            <li>ST токены дают право на дивиденды</li>
                            <li>Требуют KYC для передачи</li>
                            <li>Могут быть конвертированы в акции компании</li>
                        </ul>
                    </div>
                    
                    <div class="rule-section">
                        <h4>🎯 Utility Tokens (SPOT) - Только за активность</h4>
                        <ul>
                            <li><strong>1 SPOT за каждое 5-е посещение</strong> (авторизованная покупка)</li>
                            <li><strong>1 SPOT за 2 часа просмотра</strong> стримов</li>
                            <li><strong>1 SPOT за репост</strong> или комментарий с 50+ лайками</li>
                            <li><strong>1 SPOT за сессию стриминга</strong> (максимум 45 минут)</li>
                            <li>SPOT токены не передаются (Soulbound)</li>
                            <li>Дают право голоса в DAO</li>
                        </ul>
                    </div>
                    
                    <div class="rule-section">
                        <h4>🏆 Распределение неиспользованных чеков</h4>
                        <ul>
                            <li><strong>50% неиспользованных чеков</strong> распределяется в конце года</li>
                            <li>Участвуют только держатели SPOT выше медианного среднего</li>
                            <li>Распределение пропорционально количеству SPOT</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <h3>⚙️ Настройки токеномики</h3>
                <form id="tokenomicsSettingsForm">
                    <div class="form-group">
                        <label>ST за 1 GEL:</label>
                        <input type="number" id="stPerGel" value="0.2" step="0.01" min="0" max="1">
                    </div>
                    <div class="form-group">
                        <label>Максимальная сессия стриминга (минуты):</label>
                        <input type="number" id="maxStreamingMinutes" value="45" min="1" max="120">
                    </div>
                    <div class="form-group">
                        <label>Минимум лайков для популярного комментария:</label>
                        <input type="number" id="minLikesForComment" value="50" min="1" max="1000">
                    </div>
                    <div class="form-group">
                        <label>Процент неиспользованных чеков для распределения:</label>
                        <input type="number" id="unusedChecksPercentage" value="50" min="0" max="100">
                    </div>
                    <button type="submit" class="btn">Сохранить настройки</button>
                </form>
            </div>
            
            <div class="card">
                <h3>🔄 Конвертация UT (SPOT) в ST (THP)</h3>
                <div class="conversion-section">
                    <div class="form-group">
                        <label>Выберите держателей UT (SPOT):</label>
                        <div class="ut-holders-list">
                            <div class="ut-holder-item">
                                <input type="checkbox" id="selectAll" onchange="toggleAllHolders()">
                                <label for="selectAll"><strong>Выбрать всех</strong></label>
                            </div>
                            <div id="utHoldersList">
                                <p>Загрузка списка держателей UT...</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Курс обмена (SPOT → ST):</label>
                        <div class="exchange-rate">
                            <input type="number" id="exchangeRate" value="10" min="1" max="1000" step="1">
                            <span>SPOT = 1 ST</span>
                        </div>
                        <small>Укажите, сколько SPOT токенов нужно для получения 1 ST токена</small>
                    </div>
                    
                    <div class="conversion-summary">
                        <h4>Сводка конвертации:</h4>
                        <div id="conversionSummary">
                            <p>Выберите держателей UT для просмотра сводки</p>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <button type="button" class="btn btn-primary" onclick="executeConversion()" id="convertBtn" disabled>
                            🔄 Выполнить конвертацию
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="clearSelection()">
                            🗑️ Очистить выбор
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Учет затрат -->
        <div id="cost-accounting" class="tab-content">
            <h2>Система учета затрат</h2>
            
            <div class="grid">
                <div class="card">
                    <h3>Общие затраты сети</h3>
                    <div class="cost-summary">
                        <div class="cost-item">
                            <span class="cost-label">Сырье и ингредиенты:</span>
                            <span class="cost-value" id="ingredientsCost">0.00 GEL</span>
                        </div>
                        <div class="cost-item">
                            <span class="cost-label">Аренда и коммунальные:</span>
                            <span class="cost-value" id="rentCost">0.00 GEL</span>
                        </div>
                        <div class="cost-item">
                            <span class="cost-label">Зарплата персонала:</span>
                            <span class="cost-value" id="salaryCost">0.00 GEL</span>
                        </div>
                        <div class="cost-item">
                            <span class="cost-label">Маркетинг и реклама:</span>
                            <span class="cost-value" id="marketingCost">0.00 GEL</span>
                        </div>
                        <div class="cost-item total">
                            <span class="cost-label">Общие затраты:</span>
                            <span class="cost-value" id="totalCost">0.00 GEL</span>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h3>Расчет токенов</h3>
                    <div class="token-calculation">
                        <div class="calculation-item">
                            <span>Затраты на эмиссию:</span>
                            <span id="emissionCost">0.00 GEL</span>
                        </div>
                        <div class="calculation-item">
                            <span>Курс эмиссии:</span>
                            <span>1 THP = 5 GEL затрат</span>
                        </div>
                        <div class="calculation-item result">
                            <span>Токенов к эмиссии:</span>
                            <span id="tokensToEmit">0 THP</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <h3>Добавить затраты</h3>
                <form id="costForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Категория затрат:</label>
                            <select id="costCategory" required>
                                <option value="">Выберите категорию</option>
                                <option value="ingredients">Сырье и ингредиенты</option>
                                <option value="rent">Аренда и коммунальные</option>
                                <option value="salary">Зарплата персонала</option>
                                <option value="marketing">Маркетинг и реклама</option>
                                <option value="other">Прочие расходы</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Сумма (GEL):</label>
                            <input type="number" id="costAmount" step="0.01" min="0" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Описание:</label>
                        <textarea id="costDescription" rows="3" placeholder="Детальное описание затрат..."></textarea>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Дата:</label>
                            <input type="date" id="costDate" required>
                        </div>
                        <div class="form-group">
                            <label>Франшиза:</label>
                            <select id="franchiseId">
                                <option value="network">Вся сеть</option>
                                <option value="franchise_001">Франшиза 001</option>
                                <option value="franchise_002">Франшиза 002</option>
                            </select>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary">Добавить затраты</button>
                </form>
            </div>

            <div class="card">
                <h3>История затрат</h3>
                <div class="cost-history">
                    <table id="costHistoryTable">
                        <thead>
                            <tr>
                                <th>Дата</th>
                                <th>Категория</th>
                                <th>Сумма</th>
                                <th>Описание</th>
                                <th>Франшиза</th>
                                <th>Действия</th>
                            </tr>
                        </thead>
                        <tbody id="costHistoryBody">
                            <!-- Записи будут добавлены динамически -->
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="card">
                <h3>Прозрачность и отчетность</h3>
                <div class="transparency-section">
                    <div class="transparency-item">
                        <h4>Публичные отчеты</h4>
                        <p>Все затраты автоматически публикуются в блокчейне для обеспечения прозрачности.</p>
                        <button class="btn btn-secondary" onclick="generateTransparencyReport()">Сгенерировать отчет</button>
                    </div>
                    <div class="transparency-item">
                        <h4>API для проверки</h4>
                        <p>Покупатели могут проверить расчет токенов через публичный API.</p>
                        <button class="btn btn-secondary" onclick="showAPIDocumentation()">Документация API</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Невостребованные токены -->
        <div id="unclaimed" class="tab-content">
            <h2>Управление невостребованными токенами</h2>
            
            <div class="grid">
                <div class="card">
                    <h3>Невостребованные токены</h3>
                    <div id="unclaimedList">
                        <p>Загрузка невостребованных токенов...</p>
                    </div>
                    <button class="btn" onclick="distributeUnclaimedTokens()">Распределить в конце года</button>
                </div>

                <div class="card">
                    <h3>История распределений</h3>
                    <div id="distributionHistory">
                        <p>Загрузка истории...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Безопасность -->
        <div id="security" class="tab-content">
            <h2>Отчет по безопасности</h2>
            
            <div class="card">
                <h3>Статус безопасности сети</h3>
                <div id="securityReport">
                    <p>Загрузка отчета по безопасности...</p>
                </div>
            </div>
        </div>

        <!-- Управление стримами -->
        <div id="streams" class="tab-content">
            <h2>🎥 Управление всеми стримами сети</h2>
            
            <div class="card">
                <h3>Активные стримы</h3>
                <div id="activeStreams">
                    <p>Загрузка активных стримов...</p>
        </div>
    </div>

            <div class="card">
                <h3>Создать новый стрим</h3>
                <div class="form-group">
                    <label for="streamType">Тип стрима:</label>
                    <select id="streamType">
                        <option value="camera">Камера</option>
                        <option value="youtube">YouTube</option>
                        <option value="screen">Захват экрана</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="streamTitle">Название стрима:</label>
                    <input type="text" id="streamTitle" placeholder="Введите название стрима">
                </div>
                
                <div class="form-group" id="cameraGroup" style="display: none;">
                    <label for="cameraSelect">Выберите камеру:</label>
                    <select id="cameraSelect">
                        <option value="">Загрузка камер...</option>
                    </select>
                </div>
                
                <div class="form-group" id="youtubeGroup" style="display: none;">
                    <label for="youtubeUrl">YouTube URL:</label>
                    <input type="url" id="youtubeUrl" placeholder="https://www.youtube.com/watch?v=...">
                </div>
                
                <div class="form-group">
                    <label for="streamQuality">Качество:</label>
                    <select id="streamQuality">
                        <option value="medium">720p (Среднее)</option>
                        <option value="high">1080p (Высокое)</option>
                        <option value="ultra">4K (Ультра)</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="streamAutoStart"> Автозапуск
                    </label>
                </div>
                
                <button class="btn" onclick="createStream()">🎬 Создать стрим</button>
            </div>

            <div class="card">
                <h3>Управление стримами</h3>
                <div id="streamsList">
                    <p>Загрузка списка стримов...</p>
                </div>
            </div>
        </div>

        <!-- Управление изображениями -->
        <div id="image-management" class="tab-content">
            <h2>🖼️ Управление изображениями</h2>
            
            <div class="card">
                <h3>Загрузка изображений для замены заблюренных лиц</h3>
                <div class="form-group">
                    <label for="imageUpload">Выберите изображение:</label>
                    <input type="file" id="imageUpload" accept="image/*" multiple>
                </div>
                
                <div class="form-group">
                    <label for="imageCategory">Категория изображения:</label>
                    <select id="imageCategory">
                        <option value="face-replacement">Замена лиц</option>
                        <option value="logo">Логотип</option>
                        <option value="background">Фон</option>
                        <option value="overlay">Наложение</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="imageDescription">Описание:</label>
                    <textarea id="imageDescription" placeholder="Описание изображения"></textarea>
                </div>
                
                <button class="btn" onclick="uploadImage()">📤 Загрузить изображение</button>
            </div>

            <div class="card">
                <h3>Загруженные изображения</h3>
                <div id="uploadedImages">
                    <p>Загрузка списка изображений...</p>
                </div>
            </div>

            <div class="card">
                <h3>Настройки обработки лиц</h3>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="enableFaceBlur" checked> Включить размытие лиц
                    </label>
                </div>
                
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="enableFaceReplacement"> Заменить лица на загруженные изображения
                    </label>
                </div>
                
                <div class="form-group">
                    <label for="blurIntensity">Интенсивность размытия:</label>
                    <input type="range" id="blurIntensity" min="1" max="10" value="5">
                    <span id="blurValue">5</span>
                </div>
                
                <button class="btn" onclick="saveFaceSettings()">💾 Сохранить настройки</button>
            </div>
        </div>
    </div>

    <script>

        function loadMonitoringData() {
            // Загрузка данных мониторинга
            fetch('http://localhost:3000', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    GetOwnerStats: {}
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.OwnerStats) {
                    updateOwnerStats(data.OwnerStats);
                }
            })
            .catch(error => {
                console.log('API недоступен, используются демо-данные');
                loadDemoData();
            });

            // Загрузка алертов
            loadAlerts();
        }

        function loadDemoData() {
            document.getElementById('ownerTokens').textContent = '2,400.00';
            document.getElementById('ownerPercentage').textContent = '48.00%';
            document.getElementById('activeAlerts').textContent = '3';
            document.getElementById('franchiseNodes').textContent = '6';
            document.getElementById('charityFund').textContent = '150.00';
            document.getElementById('unclaimedTokens').textContent = '245.00';
            
            // Обновляем отображение токенов согласно новой токеномике
            document.getElementById('securityTokensCount').textContent = '0';
            document.getElementById('utilityTokensCount').textContent = '0';
        }

        function updateOwnerStats(stats) {
            // Обновляем основные статистики
            if (stats.owner_tokens !== undefined) {
                document.getElementById('ownerTokens').textContent = stats.owner_tokens.toFixed(2);
            }
            if (stats.owner_percentage !== undefined) {
                document.getElementById('ownerPercentage').textContent = stats.owner_percentage.toFixed(2) + '%';
            }
            if (stats.active_alerts !== undefined) {
                document.getElementById('activeAlerts').textContent = stats.active_alerts;
            }
            if (stats.franchise_nodes !== undefined) {
                document.getElementById('franchiseNodes').textContent = stats.franchise_nodes;
            }
            if (stats.charity_fund !== undefined) {
                document.getElementById('charityFund').textContent = stats.charity_fund.toFixed(2);
            }
            if (stats.unclaimed_tokens !== undefined) {
                document.getElementById('unclaimedTokens').textContent = stats.unclaimed_tokens.toFixed(2);
            }
            
            // Обновляем токены согласно новой токеномике
            if (stats.security_tokens !== undefined) {
                document.getElementById('securityTokensCount').textContent = stats.security_tokens.toLocaleString();
            }
            if (stats.utility_tokens !== undefined) {
                document.getElementById('utilityTokensCount').textContent = stats.utility_tokens.toLocaleString();
            }
        }

        function loadAlerts() {
            fetch('http://localhost:3000', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    GetMonitoringAlerts: { limit: 10 }
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.MonitoringAlerts) {
                    displayAlerts(data.MonitoringAlerts.alerts);
                }
            })
            .catch(error => {
                // Демо-данные для алертов
                displayAlerts([
                    {
                        alert_type: 'OwnerExceedsLimit',
                        severity: 'Critical',
                        message: 'Владелец приближается к лимиту: 47.8%',
                        timestamp: Date.now() - 3600000
                    },
                    {
                        alert_type: 'FranchiseExceedsLimit',
                        severity: 'High',
                        message: 'Владелец франшизы FranchiseOwner1 превысил лимит: 49.2%',
                        timestamp: Date.now() - 7200000
                    },
                    {
                        alert_type: 'TokenConcentration',
                        severity: 'Medium',
                        message: 'Высокая концентрация utility токенов у Customer123: 35.2%',
                        timestamp: Date.now() - 10800000
                    }
                ]);
            });
        }

        function displayAlerts(alerts) {
            const alertsList = document.getElementById('alertsList');
            let html = '';

            alerts.forEach(alert => {
                const severityClass = alert.severity.toLowerCase();
                const timeAgo = new Date(alert.timestamp).toLocaleString();
                
                html += `
                    <div class="alert ${severityClass}">
                        <strong>${getAlertTypeText(alert.alert_type)}</strong><br>
                        ${alert.message}<br>
                        <small>${timeAgo}</small>
                    </div>
                `;
            });

            alertsList.innerHTML = html || '<p>Нет активных алертов</p>';
        }

        function getAlertTypeText(alertType) {
            const types = {
                'OwnerExceedsLimit': 'Превышение лимита владельца',
                'FranchiseExceedsLimit': 'Превышение лимита франшизы',
                'CustomerExceedsLimit': 'Превышение лимита покупателя',
                'TokenConcentration': 'Концентрация токенов',
                'CharityFundLow': 'Низкий уровень фонда'
            };
            return types[alertType] || alertType;
        }

        function loadFranchises() {
            // Загрузка списка франшиз
            fetch('http://localhost:3000', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    GetFranchiseNodes: {}
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.FranchiseNodes) {
                    displayFranchises(data.FranchiseNodes.nodes);
                }
            })
            .catch(error => {
                // Демо-данные
                displayFranchises([
                    { node_id: 'FranchiseNode1', owner: 'FranchiseOwner1' },
                    { node_id: 'FranchiseNode2', owner: 'FranchiseOwner2' },
                    { node_id: 'FranchiseNode3', owner: 'FranchiseOwner3' }
                ]);
            });
        }

        function displayFranchises(franchises) {
            const franchisesList = document.getElementById('franchisesList');
            let html = '';

            franchises.forEach(franchise => {
                html += `
                    <div class="card" style="margin-bottom: 10px;">
                        <h4>${franchise.node_id}</h4>
                        <p>Владелец: ${franchise.owner}</p>
                        <button class="btn btn-secondary" onclick="removeFranchise('${franchise.node_id}')">Удалить</button>
                    </div>
                `;
            });

            franchisesList.innerHTML = html || '<p>Нет франшизных нод</p>';
        }

        function loadUnclaimedTokens() {
            // Загрузка невостребованных токенов
            fetch('http://localhost:3000', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    GetUnclaimedTokens: { limit: 50 }
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.UnclaimedTokens) {
                    displayUnclaimedTokens(data.UnclaimedTokens.tokens);
                }
            })
            .catch(error => {
                // Демо-данные
                displayUnclaimedTokens([
                    { check_id: 'CHECK_123', amount: 49.0, created_timestamp: Date.now() - 86400000 },
                    { check_id: 'CHECK_124', amount: 98.0, created_timestamp: Date.now() - 172800000 }
                ]);
            });

            // Загрузка истории распределений
            loadDistributionHistory();
        }

        function displayUnclaimedTokens(tokens) {
            const unclaimedList = document.getElementById('unclaimedList');
            let html = '';

            tokens.forEach(token => {
                const timeAgo = new Date(token.created_timestamp).toLocaleString();
                html += `
                    <div class="alert medium">
                        <strong>Чек ${token.check_id}</strong><br>
                        Сумма: ${token.amount} токенов<br>
                        <small>Создан: ${timeAgo}</small>
                    </div>
                `;
            });

            unclaimedList.innerHTML = html || '<p>Нет невостребованных токенов</p>';
        }

        function loadDistributionHistory() {
            fetch('http://localhost:3000', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    GetAnnualDistributions: { limit: 10 }
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.AnnualDistributions) {
                    displayDistributionHistory(data.AnnualDistributions.distributions);
                }
            })
            .catch(error => {
                // Демо-данные
                displayDistributionHistory([
                    { year: 2024, total_unclaimed_tokens: 245.0, distribution_timestamp: Date.now() - 86400000 }
                ]);
            });
        }

        function displayDistributionHistory(distributions) {
            const historyDiv = document.getElementById('distributionHistory');
            let html = '';

            distributions.forEach(dist => {
                const timeAgo = new Date(dist.distribution_timestamp).toLocaleString();
                html += `
                    <div class="alert low">
                        <strong>Год ${dist.year}</strong><br>
                        Распределено: ${dist.total_unclaimed_tokens} токенов<br>
                        <small>${timeAgo}</small>
                    </div>
                `;
            });

            historyDiv.innerHTML = html || '<p>Нет истории распределений</p>';
        }

        function loadSecurityReport() {
            fetch('http://localhost:3000', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    GetNetworkSecurityReport: {}
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.NetworkSecurityReport) {
                    displaySecurityReport(data.NetworkSecurityReport);
                }
            })
            .catch(error => {
                // Демо-данные
                displaySecurityReport({
                    is_secure: true,
                    total_security_tokens: 5000.0,
                    total_utility_tokens: 1000.0,
                    security_risks: [],
                    utility_risks: []
                });
            });
        }

        function displaySecurityReport(report) {
            const reportDiv = document.getElementById('securityReport');
            const statusClass = report.is_secure ? 'status-safe' : 'status-danger';
            const statusText = report.is_secure ? 'БЕЗОПАСНО' : 'ОПАСНО';

            let html = `
                <div class="status-badge ${statusClass}">${statusText}</div>
                <p><strong>Общие security токены:</strong> ${report.total_security_tokens.toFixed(2)}</p>
                <p><strong>Общие utility токены:</strong> ${report.total_utility_tokens.toFixed(2)}</p>
            `;

            if (report.security_risks && report.security_risks.length > 0) {
                html += '<h4>Риски security токенов:</h4>';
                report.security_risks.forEach(risk => {
                    html += `<div class="alert high">${risk.address}: ${risk.percentage.toFixed(2)}%</div>`;
                });
            }

            if (report.utility_risks && report.utility_risks.length > 0) {
                html += '<h4>Риски utility токенов:</h4>';
                report.utility_risks.forEach(risk => {
                    html += `<div class="alert high">${risk.address}: ${risk.percentage.toFixed(2)}%</div>`;
                });
            }

            reportDiv.innerHTML = html;
        }

        // Обработчики форм
        document.getElementById('franchiseForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const nodeId = document.getElementById('nodeId').value;
            const franchiseOwner = document.getElementById('franchiseOwner').value;

            fetch('http://localhost:3000', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    AddFranchiseNode: {
                        node_id: nodeId,
                        franchise_owner: franchiseOwner
                    }
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.FranchiseNodeAdded && data.FranchiseNodeAdded.success) {
                    showAlert('Франшизная нода успешно добавлена!', 'success');
                    document.getElementById('franchiseForm').reset();
                    loadFranchises();
                } else {
                    showAlert('Ошибка при добавлении франшизы: ' + (data.Error ? data.Error.message : 'Неизвестная ошибка'), 'error');
                }
            })
            .catch(error => {
                showAlert('Ошибка соединения с сервером', 'error');
            });
        });

        document.getElementById('emissionForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const investorAddress = document.getElementById('investorAddress').value;
            const tokenAmount = parseFloat(document.getElementById('tokenAmount').value);
            const reason = document.getElementById('emissionReason').value;

            fetch('http://localhost:3000', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    EmitTokensForInvestors: {
                        investor_address: investorAddress,
                        amount: tokenAmount,
                        reason: reason
                    }
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.TokensEmitted && data.TokensEmitted.success) {
                    showAlert('Токены успешно выпущены для инвестора!', 'success');
                    document.getElementById('emissionForm').reset();
                } else {
                    showAlert('Ошибка при эмиссии токенов: ' + (data.Error ? data.Error.message : 'Неизвестная ошибка'), 'error');
                }
            })
            .catch(error => {
                showAlert('Ошибка соединения с сервером', 'error');
            });
        });

        function distributeUnclaimedTokens() {
            fetch('http://localhost:3000', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    DistributeUnclaimedTokensAnnually: {}
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.AnnualDistribution && data.AnnualDistribution.success) {
                    showAlert('Невостребованные токены успешно распределены!', 'success');
                    loadUnclaimedTokens();
                } else {
                    showAlert('Ошибка при распределении: ' + (data.Error ? data.Error.message : 'Неизвестная ошибка'), 'error');
                }
            })
            .catch(error => {
                showAlert('Ошибка соединения с сервером', 'error');
            });
        }

        function showAlert(message, type) {
            const alert = document.createElement('div');
            alert.className = `alert ${type}`;
            alert.textContent = message;
            
            const container = document.querySelector('.tab-content.active');
            container.insertBefore(alert, container.firstChild);
            
            setTimeout(() => {
                alert.remove();
            }, 5000);
        }

        // Функции для учета затрат
        function loadCostAccountingData() {
            // Загрузка данных о затратах
            updateCostSummary();
            loadCostHistory();
        }

        function updateCostSummary() {
            // Обновление сводки затрат
            const costs = {
                ingredients: 1250.50,
                rent: 800.00,
                salary: 2100.00,
                marketing: 450.75,
                other: 200.25
            };

            document.getElementById('ingredientsCost').textContent = costs.ingredients.toFixed(2) + ' GEL';
            document.getElementById('rentCost').textContent = costs.rent.toFixed(2) + ' GEL';
            document.getElementById('salaryCost').textContent = costs.salary.toFixed(2) + ' GEL';
            document.getElementById('marketingCost').textContent = costs.marketing.toFixed(2) + ' GEL';

            const total = Object.values(costs).reduce((sum, cost) => sum + cost, 0);
            document.getElementById('totalCost').textContent = total.toFixed(2) + ' GEL';

            // Расчет токенов (1 THP = 5 GEL затрат)
            const tokensToEmit = Math.floor(total / 5);
            document.getElementById('emissionCost').textContent = total.toFixed(2) + ' GEL';
            document.getElementById('tokensToEmit').textContent = tokensToEmit + ' THP';
        }

        function loadCostHistory() {
            // Загрузка истории затрат
            const costHistory = [
                { date: '2024-01-15', category: 'Сырье и ингредиенты', amount: 250.50, description: 'Закупка риса и мяса', franchise: 'Франшиза 001' },
                { date: '2024-01-14', category: 'Зарплата персонала', amount: 500.00, description: 'Зарплата за неделю', franchise: 'Вся сеть' },
                { date: '2024-01-13', category: 'Аренда и коммунальные', amount: 200.00, description: 'Аренда помещения', franchise: 'Франшиза 002' }
            ];

            const tbody = document.getElementById('costHistoryBody');
            tbody.innerHTML = '';

            costHistory.forEach(cost => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${cost.date}</td>
                    <td>${cost.category}</td>
                    <td>${cost.amount.toFixed(2)} GEL</td>
                    <td>${cost.description}</td>
                    <td>${cost.franchise}</td>
                    <td>
                        <button class="btn btn-sm btn-secondary" onclick="editCost('${cost.date}')">Редактировать</button>
                        <button class="btn btn-sm btn-danger" onclick="deleteCost('${cost.date}')">Удалить</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function generateTransparencyReport() {
            alert('Генерация отчета о прозрачности...\nОтчет будет опубликован в блокчейне для всеобщего доступа.');
        }

        function showAPIDocumentation() {
            alert('API документация:\n\nGET /api/costs/transparency - Получить данные о затратах\nGET /api/costs/calculation - Получить расчет токенов\nPOST /api/costs/verify - Проверить корректность расчета');
        }

        function editCost(costId) {
            alert('Редактирование затраты: ' + costId);
        }

        function deleteCost(costId) {
            if (confirm('Вы уверены, что хотите удалить эту запись о затратах?')) {
                alert('Затрата удалена: ' + costId);
                loadCostHistory();
            }
        }

        // Обновленная функция showTab
        function showTab(tabName) {
            // Скрыть все вкладки
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // Показать выбранную вкладку
            document.getElementById(tabName).classList.add('active');
            document.querySelector(`[onclick="showTab('${tabName}')"]`).classList.add('active');

            // Загрузить данные для конкретной вкладки
            if (tabName === 'monitoring') {
                loadMonitoringData();
            } else if (tabName === 'franchises') {
                loadFranchises();
            } else if (tabName === 'token-emission') {
                loadUTHolders();
            } else if (tabName === 'cost-accounting') {
                loadCostAccountingData();
            } else if (tabName === 'streams') {
                loadStreamsData();
            } else if (tabName === 'image-management') {
                loadImageManagementData();
            } else if (tabName === 'unclaimed') {
                loadUnclaimedTokens();
            } else if (tabName === 'security') {
                loadSecurityReport();
            }
        }

        // Обработчик формы затрат
        document.getElementById('costForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = {
                category: document.getElementById('costCategory').value,
                amount: parseFloat(document.getElementById('costAmount').value),
                description: document.getElementById('costDescription').value,
                date: document.getElementById('costDate').value,
                franchise: document.getElementById('franchiseId').value
            };

            // Добавление новой записи о затратах
            alert('Затраты добавлены:\n' + 
                  'Категория: ' + formData.category + '\n' +
                  'Сумма: ' + formData.amount + ' GEL\n' +
                  'Дата: ' + formData.date);

            // Очистка формы
            this.reset();
            
            // Обновление данных
            loadCostAccountingData();
        });

        // Инициализация
        // Функции для управления стримами
        function loadStreamsData() {
            loadActiveStreams();
            loadStreamsList();
            loadCameras();
        }

        function loadActiveStreams() {
            fetch('http://localhost:8083/api/streams')
                .then(response => response.json())
                .then(streams => {
                    const activeStreams = streams.filter(stream => stream.status === 'Running');
                    const container = document.getElementById('activeStreams');
                    
                    if (activeStreams.length === 0) {
                        container.innerHTML = '<p>Нет активных стримов</p>';
                        return;
                    }
                    
                    container.innerHTML = activeStreams.map(stream => `
                        <div class="stream-item">
                            <h4>${stream.metadata.title}</h4>
                            <p>Тип: ${getStreamTypeName(stream.stream_type)}</p>
                            <p>Статус: <span class="status-running">Работает</span></p>
                            <button class="btn btn-danger" onclick="stopStream('${stream.stream_id}')">⏹️ Остановить</button>
                        </div>
                    `).join('');
                })
                .catch(error => {
                    document.getElementById('activeStreams').innerHTML = '<p>Ошибка загрузки стримов</p>';
                });
        }

        function loadStreamsList() {
            fetch('http://localhost:8083/api/streams')
                .then(response => response.json())
                .then(streams => {
                    const container = document.getElementById('streamsList');
                    
                    if (streams.length === 0) {
                        container.innerHTML = '<p>Нет созданных стримов</p>';
                        return;
                    }
                    
                    container.innerHTML = streams.map(stream => `
                        <div class="stream-item">
                            <h4>${stream.metadata.title}</h4>
                            <p>Тип: ${getStreamTypeName(stream.stream_type)}</p>
                            <p>Статус: <span class="status-${stream.status.toLowerCase()}">${getStatusName(stream.status)}</span></p>
                            <p>Создан: ${new Date(stream.created_at).toLocaleString()}</p>
                            <div class="stream-actions">
                                <button class="btn btn-success" onclick="startStream('${stream.stream_id}')" 
                                        ${stream.status === 'Running' ? 'disabled' : ''}>
                                    ▶️ Запустить
                                </button>
                                <button class="btn btn-danger" onclick="stopStream('${stream.stream_id}')"
                                        ${stream.status === 'Stopped' ? 'disabled' : ''}>
                                    ⏹️ Остановить
                                </button>
                                <button class="btn btn-warning" onclick="deleteStream('${stream.stream_id}')">
                                    🗑️ Удалить
                                </button>
                            </div>
                        </div>
                    `).join('');
                })
                .catch(error => {
                    document.getElementById('streamsList').innerHTML = '<p>Ошибка загрузки списка стримов</p>';
                });
        }

        function loadCameras() {
            fetch('http://localhost:8083/api/cameras')
                .then(response => response.json())
                .then(cameras => {
                    const select = document.getElementById('cameraSelect');
                    select.innerHTML = '<option value="">Выберите камеру</option>';
                    
                    cameras.forEach(camera => {
                        const option = document.createElement('option');
                        option.value = camera.device_id;
                        option.textContent = `${camera.name} (${camera.resolution})`;
                        select.appendChild(option);
                    });
                })
                .catch(error => {
                    document.getElementById('cameraSelect').innerHTML = '<option value="">Ошибка загрузки камер</option>';
                });
        }

        function createStream() {
            const streamType = document.getElementById('streamType').value;
            const title = document.getElementById('streamTitle').value;
            const quality = document.getElementById('streamQuality').value;
            const autoStart = document.getElementById('streamAutoStart').checked;
            
            if (!title) {
                alert('Введите название стрима');
                return;
            }
            
            let requestData = {
                title: title,
                quality: quality,
                auto_start: autoStart
            };
            
            let endpoint = '';
            
            if (streamType === 'camera') {
                const deviceId = document.getElementById('cameraSelect').value;
                if (!deviceId) {
                    alert('Выберите камеру');
                    return;
                }
                requestData.device_id = deviceId;
                endpoint = 'http://localhost:8083/api/streams/camera';
            } else if (streamType === 'youtube') {
                const url = document.getElementById('youtubeUrl').value;
                if (!url) {
                    alert('Введите YouTube URL');
                    return;
                }
                requestData.url = url;
                endpoint = 'http://localhost:8083/api/streams/youtube';
            }
            
            fetch(endpoint, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(requestData)
            })
            .then(response => response.json())
            .then(result => {
                if (result.status === 'created') {
                    alert('Стрим создан успешно!');
                    loadStreamsData();
                    // Очистить форму
                    document.getElementById('streamTitle').value = '';
                    document.getElementById('youtubeUrl').value = '';
                } else {
                    alert('Ошибка создания стрима: ' + result.message);
                }
            })
            .catch(error => {
                alert('Ошибка создания стрима: ' + error.message);
            });
        }

        function startStream(streamId) {
            fetch(`http://localhost:8083/api/streams/start/${streamId}`, {
                method: 'POST'
            })
            .then(response => response.json())
            .then(result => {
                if (result.status === 'success') {
                    alert('Стрим запущен!');
                    loadStreamsData();
                } else {
                    alert('Ошибка запуска стрима: ' + result.message);
                }
            })
            .catch(error => {
                alert('Ошибка запуска стрима: ' + error.message);
            });
        }

        function stopStream(streamId) {
            fetch(`http://localhost:8083/api/streams/stop/${streamId}`, {
                method: 'POST'
            })
            .then(response => response.json())
            .then(result => {
                if (result.status === 'success') {
                    alert('Стрим остановлен!');
                    loadStreamsData();
                } else {
                    alert('Ошибка остановки стрима: ' + result.message);
                }
            })
            .catch(error => {
                alert('Ошибка остановки стрима: ' + error.message);
            });
        }

        function deleteStream(streamId) {
            if (confirm('Вы уверены, что хотите удалить этот стрим?')) {
                // Здесь будет API для удаления стрима
                alert('Функция удаления стрима будет реализована в следующей версии');
            }
        }

        // Функции для управления изображениями
        function loadImageManagementData() {
            loadUploadedImages();
            loadFaceSettings();
        }

        function loadUploadedImages() {
            // Здесь будет загрузка списка загруженных изображений
            document.getElementById('uploadedImages').innerHTML = '<p>Список загруженных изображений будет загружен</p>';
        }

        function loadFaceSettings() {
            // Загрузка настроек обработки лиц
            // Здесь будут настройки по умолчанию
        }

        function uploadImage() {
            const fileInput = document.getElementById('imageUpload');
            const category = document.getElementById('imageCategory').value;
            const description = document.getElementById('imageDescription').value;
            
            if (!fileInput.files.length) {
                alert('Выберите изображение для загрузки');
                return;
            }
            
            const formData = new FormData();
            formData.append('image', fileInput.files[0]);
            formData.append('category', category);
            formData.append('description', description);
            
            // Здесь будет API для загрузки изображений
            alert('Изображение загружено успешно! (Функция будет реализована в следующей версии)');
            
            // Очистить форму
            fileInput.value = '';
            document.getElementById('imageDescription').value = '';
        }

        function saveFaceSettings() {
            const enableBlur = document.getElementById('enableFaceBlur').checked;
            const enableReplacement = document.getElementById('enableFaceReplacement').checked;
            const blurIntensity = document.getElementById('blurIntensity').value;
            
            const settings = {
                enableBlur: enableBlur,
                enableReplacement: enableReplacement,
                blurIntensity: parseInt(blurIntensity)
            };
            
            // Здесь будет API для сохранения настроек
            alert('Настройки сохранены! (Функция будет реализована в следующей версии)');
        }

        // Вспомогательные функции
        function getStreamTypeName(type) {
            const types = {
                'Camera': '📹 Камера',
                'YouTube': '📺 YouTube',
                'File': '📁 Файл',
                'ScreenCapture': '🖥️ Захват экрана'
            };
            return types[type] || type;
        }

        function getStatusName(status) {
            const statuses = {
                'Stopped': 'Остановлен',
                'Starting': 'Запускается',
                'Running': 'Работает',
                'Paused': 'Приостановлен',
                'Error': 'Ошибка'
            };
            return statuses[status] || status;
        }

        // Обработчик изменения типа стрима
        document.getElementById('streamType').addEventListener('change', function() {
            const streamType = this.value;
            const cameraGroup = document.getElementById('cameraGroup');
            const youtubeGroup = document.getElementById('youtubeGroup');
            
            cameraGroup.style.display = streamType === 'camera' ? 'block' : 'none';
            youtubeGroup.style.display = streamType === 'youtube' ? 'block' : 'none';
        });

        // Обработчик изменения интенсивности размытия
        document.getElementById('blurIntensity').addEventListener('input', function() {
            document.getElementById('blurValue').textContent = this.value;
        });

        // Обработчик формы настроек токеномики
        document.getElementById('tokenomicsSettingsForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const settings = {
                st_per_gel: parseFloat(document.getElementById('stPerGel').value),
                max_streaming_minutes: parseInt(document.getElementById('maxStreamingMinutes').value),
                min_likes_for_comment: parseInt(document.getElementById('minLikesForComment').value),
                unused_checks_percentage: parseInt(document.getElementById('unusedChecksPercentage').value)
            };
            
            // Отправка настроек на сервер
            fetch('http://localhost:3000', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    method: 'update_tokenomics_settings',
                    params: settings
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showAlert('Настройки токеномики успешно сохранены!', 'success');
                } else {
                    showAlert('Ошибка при сохранении настроек: ' + (data.error || 'Неизвестная ошибка'), 'error');
                }
            })
            .catch(error => {
                showAlert('Ошибка при сохранении настроек: ' + error.message, 'error');
            });
        });

        // Функции для конвертации UT в ST
        let utHolders = [];
        let selectedHolders = new Set();

        function loadUTHolders() {
            // Загрузка списка держателей UT с сервера
            fetch('http://localhost:3000', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    GetUTHolders: {}
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.UTHolders) {
                    utHolders = data.UTHolders.sort((a, b) => b.balance - a.balance);
                    displayUTHolders();
                }
            })
            .catch(error => {
                console.log('API недоступен, используются демо-данные');
                loadDemoUTHolders();
            });
        }

        function loadDemoUTHolders() {
            // Демо-данные для держателей UT
            utHolders = [
                { address: '0x1234...5678', balance: 150, name: 'Активный пользователь 1' },
                { address: '0x2345...6789', balance: 120, name: 'Активный пользователь 2' },
                { address: '0x3456...7890', balance: 95, name: 'Стример еды' },
                { address: '0x4567...8901', balance: 80, name: 'Постоянный клиент' },
                { address: '0x5678...9012', balance: 65, name: 'Участник DAO' },
                { address: '0x6789...0123', balance: 45, name: 'Лояльный клиент' },
                { address: '0x7890...1234', balance: 30, name: 'Новый пользователь' },
                { address: '0x8901...2345', balance: 20, name: 'Тестовый аккаунт' },
                { address: '0x9012...3456', balance: 15, name: 'Демо пользователь' },
                { address: '0x0123...4567', balance: 10, name: 'Гость' }
            ];
            displayUTHolders();
        }

        function displayUTHolders() {
            const container = document.getElementById('utHoldersList');
            container.innerHTML = '';

            utHolders.forEach((holder, index) => {
                const holderItem = document.createElement('div');
                holderItem.className = 'ut-holder-item';
                holderItem.innerHTML = `
                    <input type="checkbox" id="holder_${index}" value="${holder.address}" onchange="toggleHolder('${holder.address}')">
                    <label for="holder_${index}">
                        <span>${holder.name || holder.address}</span>
                        <span class="ut-balance">${holder.balance} SPOT</span>
                    </label>
                `;
                container.appendChild(holderItem);
            });
        }

        function toggleHolder(address) {
            const checkbox = document.querySelector(`input[value="${address}"]`);
            if (checkbox.checked) {
                selectedHolders.add(address);
            } else {
                selectedHolders.delete(address);
            }
            updateConversionSummary();
            updateConvertButton();
        }

        function toggleAllHolders() {
            const selectAllCheckbox = document.getElementById('selectAll');
            const holderCheckboxes = document.querySelectorAll('#utHoldersList input[type="checkbox"]');
            
            holderCheckboxes.forEach(checkbox => {
                checkbox.checked = selectAllCheckbox.checked;
                if (selectAllCheckbox.checked) {
                    selectedHolders.add(checkbox.value);
                } else {
                    selectedHolders.delete(checkbox.value);
                }
            });
            
            updateConversionSummary();
            updateConvertButton();
        }

        function updateConversionSummary() {
            const summaryContainer = document.getElementById('conversionSummary');
            const exchangeRate = parseInt(document.getElementById('exchangeRate').value) || 10;
            
            if (selectedHolders.size === 0) {
                summaryContainer.innerHTML = '<p>Выберите держателей UT для просмотра сводки</p>';
                return;
            }

            let totalSPOT = 0;
            let totalST = 0;
            let conversionDetails = [];

            selectedHolders.forEach(address => {
                const holder = utHolders.find(h => h.address === address);
                if (holder) {
                    const stToReceive = Math.floor(holder.balance / exchangeRate);
                    totalSPOT += holder.balance;
                    totalST += stToReceive;
                    conversionDetails.push({
                        name: holder.name || holder.address,
                        spot: holder.balance,
                        st: stToReceive
                    });
                }
            });

            let summaryHTML = `
                <div class="conversion-item">
                    <span>Всего выбрано держателей:</span>
                    <span>${selectedHolders.size}</span>
                </div>
            `;

            conversionDetails.forEach(detail => {
                summaryHTML += `
                    <div class="conversion-item">
                        <span>${detail.name}:</span>
                        <span>${detail.spot} SPOT → ${detail.st} ST</span>
                    </div>
                `;
            });

            summaryHTML += `
                <div class="conversion-item">
                    <span>Общая сумма:</span>
                    <span>${totalSPOT} SPOT → ${totalST} ST</span>
                </div>
            `;

            summaryContainer.innerHTML = summaryHTML;
        }

        function updateConvertButton() {
            const convertBtn = document.getElementById('convertBtn');
            convertBtn.disabled = selectedHolders.size === 0;
        }

        function executeConversion() {
            if (selectedHolders.size === 0) {
                showAlert('Выберите хотя бы одного держателя UT', 'error');
                return;
            }

            const exchangeRate = parseInt(document.getElementById('exchangeRate').value) || 10;
            const confirmMessage = `Вы уверены, что хотите конвертировать UT в ST по курсу ${exchangeRate} SPOT = 1 ST для ${selectedHolders.size} держателей?`;

            if (confirm(confirmMessage)) {
                // Отправка запроса на конвертацию
                const conversionData = {
                    ConvertUTToST: {
                        holders: Array.from(selectedHolders),
                        exchange_rate: exchangeRate
                    }
                };

                fetch('http://localhost:3000', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(conversionData)
                })
                .then(response => response.json())
                .then(data => {
                    if (data.ConversionResult) {
                        showAlert('Конвертация выполнена успешно!', 'success');
                        clearSelection();
                        loadUTHolders(); // Обновить список
                    } else {
                        showAlert('Ошибка при выполнении конвертации', 'error');
                    }
                })
                .catch(error => {
                    console.log('API недоступен, симуляция конвертации');
                    showAlert('Конвертация выполнена успешно! (демо-режим)', 'success');
                    clearSelection();
                    loadDemoUTHolders(); // Обновить список
                });
            }
        }

        function clearSelection() {
            selectedHolders.clear();
            document.getElementById('selectAll').checked = false;
            const holderCheckboxes = document.querySelectorAll('#utHoldersList input[type="checkbox"]');
            holderCheckboxes.forEach(checkbox => {
                checkbox.checked = false;
            });
            updateConversionSummary();
            updateConvertButton();
        }

        // Обновление сводки при изменении курса обмена
        document.getElementById('exchangeRate').addEventListener('input', updateConversionSummary);

        document.addEventListener('DOMContentLoaded', function() {
            loadMonitoringData();
            // Установить сегодняшнюю дату по умолчанию
            document.getElementById('costDate').value = new Date().toISOString().split('T')[0];
        });
    </script>
</body>
</html>
