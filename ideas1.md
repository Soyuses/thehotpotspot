# План развития системы Food Truck Network

## 1. Исправление распределения токенов

### Текущая проблема
- Security:Utility токены отображаются как 5:1
- Должно быть 1:1 для справедливого распределения

### Исправление
```javascript
// В owner_dashboard.html изменить логику отображения
// Security и Utility токены должны быть равными
```

## 2. Путь покупателя (Customer Journey)

### 2.1 Первый заказ
1. **Покупатель делает заказ** → получает физический чек
2. **Чек содержит**:
   - QR-код с данными: `check_id|wallet_address|amount|timestamp`
   - Адрес кошелька в блокчейне TheHotPotSpot
   - Инструкции по активации

### 2.2 Выбор покупателя
**Вариант А**: Выбрасывает чек → токены остаются в обезличенном кошельке
**Вариант Б**: Сканирует QR-код → переходит к мобильному приложению

**Важно**: Выбор происходит в голове покупателя - это развилка логики. В конце года неактивированные (не забранные) токены распределяются по существующей логике между участниками сети.

### 2.3 Мобильное приложение
1. **Скачивание**: Выбор ОС (Android/iOS)
2. **Авторизация**: По номеру телефона
3. **Регистрация** (если новый пользователь):
   - Полное имя (обязательно)
   - Email для рассылок (обязательно)
   - Размер футболки (XXS-XXL)
   - Любимое блюдо (string)
   - Пароль с подтверждением (KYC требования)
   - **Обязательно**: Сканирование QR-кода чека

### 2.4 Привязка кошелька
- Сканирование QR-кода → перевод токенов с обезличенного кошелька на личный
- Если уже зарегистрирован → только сканирование QR-кода

## 3. Система токенизации

### 3.1 Эмиссия токенов
**Рекомендация**: Привязка к затраченным 5 лари (вашим затратам)

**Преимущества**:
- **Максимальная прозрачность**: Покупатели видят реальную стоимость
- **Доверие**: Показываете честность в ценообразовании
- **Маркетинг**: "Каждые 5 лари наших затрат = 1 токен для вас"
- **Управление**: Контролируете эмиссию через управление затратами

**Формула**: `1 токен = 5 лари ваших затрат`

### 3.2 Система учета затрат

**Интерфейсы для учета:**
- **Владелец сети**: Вкладка "Учет затрат" в дашборде
- **Франчайзи**: Вкладка "План закупок" в интерфейсе франшизы

**Логика планирования:**
1. **Рецепты блюд** → определяют необходимые ингредиенты
2. **План закупки** → формируется автоматически на основе рецептов
3. **Пример**: 
   - Плов требует: рис (200г), мясо (150г), лук (50г), морковь (50г)
   - На 100 порций плова нужно: 20кг риса, 15кг мяса, 5кг лука, 5кг моркови
   - Франчайзи заносит фактические закупки в систему

**Структура затрат:**
```
Общие затраты франшизы:
├── Сырье и ингредиенты (40%) - отслеживается по рецептам
├── Аренда и коммунальные услуги (20%)
├── Зарплата персонала (25%)
├── Маркетинг и реклама (10%)
└── Прочие расходы (5%)
```

## 4. Бизнес-требования

### 4.1 Прозрачность
- **Публичная отчетность**: Ежемесячные отчеты о затратах
- **Блокчейн-аудит**: Все транзакции записываются в блокчейн
- **API для проверки**: Покупатели могут проверить расчет токенов

### 4.2 Мотивация покупателей
- **Лояльность**: Накопление токенов = скидки
- **Участие в управлении**: Голосование за меню
- **Эксклюзивность**: Доступ к специальным предложениям

### 4.3 Управление рисками
- **Лимиты эмиссии**: Максимум токенов в месяц
- **Резервный фонд**: 10% от выручки на покрытие колебаний
- **Страхование**: Защита от форс-мажоров

## 5. Системные требования

### 5.1 Мобильное приложение
**Технологии**: React Native
**Функции**:
- QR-сканер
- Управление кошельком
- История заказов
- Голосование за меню
- Push-уведомления

### 5.2 Блокчейн интеграция
**Требования**:
- Смарт-контракты для эмиссии токенов
- Автоматический расчет на основе затрат
- API для мобильного приложения
- Веб-интерфейс для мониторинга

### 5.3 База данных
**Структура**:
```sql
-- Пользователи
users (id, phone, name, email, tshirt_size, favorite_dish, created_at)

-- Чеки
checks (id, wallet_address, amount, qr_data, created_at, claimed_at)

-- Кошельки
wallets (id, user_id, address, balance, created_at)

-- Затраты
expenses (id, category, amount, description, date, franchise_id)

-- Токены
tokens (id, user_id, amount, source, created_at)
```

## 6. Архитектура системы

### 6.1 Компоненты
```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   Mobile App    │    │   Web Dashboard │    │  POS Terminal   │
│   (React Native)│    │   (React)       │    │   (Rust)        │
└─────────┬───────┘    └─────────┬───────┘    └─────────┬───────┘
          │                      │                      │
          └──────────────────────┼──────────────────────┘
                                 │
                    ┌─────────────┴─────────────┐
                    │     API Gateway           │
                    │     (Rust + Axum)         │
                    └─────────────┬─────────────┘
                                  │
                    ┌─────────────┴─────────────┐
                    │   Blockchain Network      │
                    │   (Custom PoS)            │
                    └─────────────┬─────────────┘
                                  │
                    ┌─────────────┴─────────────┐
                    │   Database (PostgreSQL)   │
                    └───────────────────────────┘
```

### 6.2 Поток данных
1. **Заказ** → POS создает чек с QR-кодом
2. **QR-код** → Содержит wallet_address и check_id
3. **Сканирование** → Мобильное приложение получает данные
4. **Регистрация/Авторизация** → Создание/привязка кошелька
5. **Перевод токенов** → С обезличенного на личный кошелек

## 7. Рекомендации по изменению кода

### 7.1 Создать новые модули
```rust
// src/mobile_app_integration.rs
pub struct MobileAppIntegration {
    qr_generator: QRCodeGenerator,
    wallet_manager: WalletManager,
    user_registration: UserRegistration,
}

// src/expense_tracking.rs
pub struct ExpenseTracker {
    categories: Vec<ExpenseCategory>,
    monthly_limits: HashMap<String, f64>,
    transparency_reports: TransparencyReporter,
}

// src/customer_journey.rs
pub struct CustomerJourney {
    check_generator: CheckGenerator,
    qr_scanner: QRScanner,
    wallet_transfer: WalletTransfer,
}

// src/recipe_management.rs
pub struct RecipeManager {
    recipes: HashMap<String, Recipe>,
    ingredient_calculator: IngredientCalculator,
}

pub struct Recipe {
    id: String,
    name: String,
    ingredients: Vec<Ingredient>,
    portions: u32,
}

pub struct Ingredient {
    name: String,
    amount_per_portion: f64, // в граммах
    unit: String,
    cost_per_unit: f64,
}

// src/purchase_planning.rs
pub struct PurchasePlanner {
    recipe_manager: RecipeManager,
    demand_forecaster: DemandForecaster,
}

pub struct PurchasePlan {
    franchise_id: String,
    period: DateRange,
    planned_dishes: HashMap<String, u32>, // блюдо -> количество порций
    required_ingredients: HashMap<String, f64>, // ингредиент -> количество
    estimated_costs: f64,
}

// src/cost_tracking.rs
pub struct CostTracker {
    purchase_planner: PurchasePlanner,
    actual_purchases: Vec<ActualPurchase>,
    cost_analyzer: CostAnalyzer,
}

pub struct ActualPurchase {
    franchise_id: String,
    ingredient: String,
    amount: f64,
    cost: f64,
    date: DateTime,
    supplier: String,
}
```

### 7.2 Обновить существующие модули
```rust
// src/tokenomics.rs - добавить привязку к затратам
impl Tokenomics {
    pub fn calculate_tokens_from_expenses(&self, expenses: &[Expense]) -> u64 {
        let total_expenses = expenses.iter().map(|e| e.amount).sum::<f64>();
        (total_expenses / 5.0) as u64 // 1 токен за каждые 5 лари затрат
    }
}

// src/wallet_management.rs - добавить обезличенные кошельки
impl WalletManager {
    pub fn create_anonymous_wallet(&self) -> AnonymousWallet {
        // Создание кошелька без привязки к пользователю
    }
    
    pub fn transfer_to_user_wallet(&self, from: AnonymousWallet, to: UserWallet) -> Result<()> {
        // Перевод токенов с обезличенного на пользовательский
    }
}
```

### 7.3 API endpoints
```rust
// Новые endpoints
POST /api/checks/generate          // Генерация чека с QR-кодом
POST /api/qr/scan                  // Сканирование QR-кода
POST /api/users/register           // Регистрация пользователя
POST /api/wallets/transfer         // Перевод токенов
GET  /api/expenses/transparency    // Прозрачность затрат
POST /api/expenses/add             // Добавление затрат

// Система учета затрат
GET  /api/recipes                  // Получить все рецепты
POST /api/recipes                  // Создать новый рецепт
GET  /api/recipes/{id}/ingredients // Получить ингредиенты рецепта
POST /api/purchase-plans           // Создать план закупок
GET  /api/purchase-plans/{franchise_id} // Получить план франшизы
POST /api/purchases                // Занести фактическую закупку
GET  /api/purchases/{franchise_id} // Получить закупки франшизы
GET  /api/cost-analysis/{franchise_id} // Анализ затрат франшизы
POST /api/demand-forecast          // Прогноз спроса на блюда
```

### 7.4 Мобильное приложение
```typescript
// Структура React Native приложения
src/
├── components/
│   ├── QRScanner.tsx
│   ├── WalletManager.tsx
│   ├── UserRegistration.tsx
│   └── OrderHistory.tsx
├── services/
│   ├── api.ts
│   ├── blockchain.ts
│   └── storage.ts
├── screens/
│   ├── LoginScreen.tsx
│   ├── RegisterScreen.tsx
│   ├── WalletScreen.tsx
│   └── MenuScreen.tsx
└── utils/
    ├── qrCode.ts
    └── validation.ts
```

## 8. План реализации

### Фаза 1: Исправления и базовая система учета (1 неделя)
- [x] Исправить распределение токенов 1:1
- [ ] Добавить модуль expense_tracking
- [ ] Создать модуль recipe_management
- [ ] Создать модуль purchase_planning
- [ ] Добавить вкладки "Учет затрат" в интерфейсы
- [ ] Создать API для генерации чеков

### Фаза 2: QR-коды и кошельки (2 недели)
- [ ] Реализовать генерацию QR-кодов
- [ ] Создать обезличенные кошельки
- [ ] Добавить перевод токенов

### Фаза 3: Мобильное приложение (3 недели)
- [ ] Создать React Native приложение
- [ ] Реализовать QR-сканер
- [ ] Добавить регистрацию пользователей

### Фаза 4: Прозрачность (1 неделя)
- [ ] Создать отчеты о затратах
- [ ] Добавить API для проверки
- [ ] Реализовать публичную отчетность

### Фаза 5: Тестирование (1 неделя)
- [ ] Интеграционные тесты
- [ ] Тестирование пользовательского пути
- [ ] Оптимизация производительности

## 9. Бизнес-преимущества

### 9.1 Для покупателей
- **Прозрачность**: Видят реальную стоимость продуктов
- **Лояльность**: Накопление токенов = скидки
- **Участие**: Голосование за меню
- **Доверие**: Блокчейн-аудит всех операций

### 9.2 Для бизнеса
- **Маркетинг**: Уникальное предложение на рынке
- **Данные**: Аналитика предпочтений клиентов
- **Финансирование**: Предоплата через токены
- **Масштабирование**: Франшизная модель

### 9.3 Для франшиз
- **Прозрачность**: Четкое понимание затрат
- **Мотивация**: Стимул к оптимизации
- **Контроль**: Автоматический расчет токенов
- **Отчетность**: Готовая система учета

## 10. Риски и митигация

### 10.1 Технические риски
- **Блокчейн**: Высокая нагрузка → Шардинг и оптимизация
- **Мобильное приложение**: Сложность разработки → Поэтапная реализация
- **Интеграция**: Совместимость систем → API-first подход

### 10.2 Бизнес-риски
- **Принятие**: Низкое использование → Образование и маркетинг
- **Регулирование**: Изменение законов → Юридическая экспертиза
- **Конкуренция**: Копирование → Патентование и уникальность

### 10.3 Финансовые риски
- **Волатильность**: Изменение курса → Фиксация в лари
- **Ликвидность**: Недостаток токенов → Резервный фонд
- **Мошенничество**: Подделка QR-кодов → Криптографическая защита

## 11. Метрики успеха

### 11.1 Пользовательские метрики
- Количество скачанных приложений
- Процент активированных QR-кодов
- Среднее время использования приложения
- Количество повторных заказов

### 11.2 Бизнес-метрики
- Объем эмитированных токенов
- Прозрачность затрат (публичные отчеты)
- Рост выручки франшиз
- Удовлетворенность клиентов

### 11.3 Технические метрики
- Время отклика API
- Доступность системы
- Количество ошибок
- Производительность блокчейна

---

**Заключение**: Данный план обеспечивает максимальную прозрачность, доверие клиентов и уникальное конкурентное преимущество. Привязка токенов к вашим затратам создает честную и понятную систему, которая может стать стандартом в индустрии.
