# 🏗️ Архитектура системы

## Общая схема

```
┌─────────────────────────────────────────────────────────────────┐
│                    BLOCKCHAIN RESTAURANT SYSTEM                │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────┐    ┌─────────────────┐    ┌──────────────┐ │
│  │   RESTAURANT    │    │    CUSTOMER     │    │   EXTERNAL   │ │
│  │   OWNER UI      │    │    WALLET UI    │    │   SYSTEMS    │ │
│  │                 │    │                 │    │              │ │
│  │ • Manage Menu   │    │ • View Menu     │    │ • API Calls  │ │
│  │ • View Orders   │    │ • Place Orders  │    │ • Integration│ │
│  │ • Confirm Orders│    │ • Check Status  │    │ • Data Sync  │ │
│  │ • Voting Mgmt   │    │ • View Balance  │    │              │ │
│  └─────────────────┘    └─────────────────┘    └──────────────┘ │
│           │                       │                       │      │
│           └───────────────────────┼───────────────────────┘      │
│                                   │                              │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │                    API SERVER (Port 8080)                  │ │
│  │                                                             │ │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐  │ │
│  │  │   GET       │  │   POST      │  │     RESPONSES       │  │ │
│  │  │ • Menu      │  │ • Orders    │  │ • JSON Format       │  │ │
│  │  │ • Items     │  │ • Cancel    │  │ • Error Handling    │  │ │
│  │  │ • Status    │  │ • Create    │  │ • Status Codes      │  │ │
│  │  │ • Balance   │  │             │  │                     │  │ │
│  │  └─────────────┘  └─────────────┘  └─────────────────────┘  │ │
│  └─────────────────────────────────────────────────────────────┘ │
│                                   │                              │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │                    BLOCKCHAIN CORE                         │ │
│  │                                                             │ │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐  │ │
│  │  │   MENU      │  │   ORDERS    │  │      TOKENS         │  │ │
│  │  │ MANAGEMENT  │  │ MANAGEMENT  │  │   MANAGEMENT        │  │ │
│  │  │             │  │             │  │                     │  │ │
│  │  │ • Add Items │  │ • Create    │  │ • Security Tokens   │  │ │
│  │  │ • Voting    │  │ • Confirm   │  │ • Utility Tokens    │  │ │
│  │  │ • Status    │  │ • Cancel    │  │ • Role Assignment   │  │ │
│  │  │ • Details   │  │ • Track     │  │ • Balance Updates   │  │ │
│  │  └─────────────┘  └─────────────┘  └─────────────────────┘  │ │
│  │                                                             │ │
│  │  ┌─────────────────────────────────────────────────────────┐ │ │
│  │  │                BLOCKCHAIN STORAGE                      │ │ │
│  │  │                                                         │ │ │
│  │  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────────┐ │ │ │
│  │  │  │    BLOCKS   │  │TRANSACTIONS │  │   TOKEN HOLDERS │ │ │ │
│  │  │  │             │  │             │  │                 │ │ │ │
│  │  │  │ • Genesis   │  │ • Purchases │  │ • Main Owner    │ │ │ │
│  │  │  │ • Mined     │  │ • Orders    │  │ • Customers     │ │ │ │
│  │  │  │ • Validated │  │ • Rewards   │  │ • Roles         │ │ │ │
│  │  │  │ • Chained   │  │ • Voting    │  │ • Balances      │ │ │ │
│  │  │  └─────────────┘  └─────────────┘  └─────────────────┘ │ │ │
│  │  └─────────────────────────────────────────────────────────┘ │ │
│  └─────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────┘
```

## Поток данных

### 1. Добавление позиции в меню
```
Restaurant Owner → API Server → Blockchain Core → Menu Storage
```

### 2. Создание заказа
```
Customer Wallet → API Server → Blockchain Core → Order Storage
```

### 3. Подтверждение заказа
```
Restaurant Owner → API Server → Blockchain Core → 
  ├─ Order Status Update
  ├─ Token Issuance
  └─ Balance Update
```

### 4. Голосование за блюда
```
Token Holder → API Server → Blockchain Core → 
  ├─ Vote Recording
  └─ Menu Item Status Update
```

## Компоненты системы

### 1. API Server
- **Порт**: 8080
- **Протокол**: HTTP/JSON
- **Функции**:
  - Обработка запросов от UI и внешних систем
  - Валидация данных
  - Маршрутизация к блокчейн-функциям
  - Формирование ответов

### 2. Blockchain Core
- **Функции**:
  - Управление меню и заказами
  - Обработка токенов и ролей
  - Майнинг блоков
  - Валидация транзакций

### 3. Storage Layer
- **Блоки**: Цепочка блоков с транзакциями
- **Меню**: Позиции с полной информацией
- **Заказы**: Статусы и детали заказов
- **Токены**: Балансы и роли пользователей

## Роли и права доступа

```
┌─────────────────────────────────────────────────────────────┐
│                    USER ROLES & PERMISSIONS                │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐  │
│  │ MAIN OWNER  │  │ BIG STACK   │  │   MIDDLE PLAYER     │  │
│  │             │  │             │  │                     │  │
│  │ • Add Menu  │  │ • Suggest   │  │ • Vote on Items     │  │
│  │ • Confirm   │  │   Items     │  │ • View Orders       │  │
│  │   Orders    │  │ • Vote      │  │ • Manage Account    │  │
│  │ • Manage    │  │ • High      │  │ • List for Sale     │  │
│  │   Voting    │  │   Influence │  │                     │  │
│  │ • Full      │  │             │  │                     │  │
│  │   Control   │  │             │  │                     │  │
│  └─────────────┘  └─────────────┘  └─────────────────────┘  │
│                                                             │
│  ┌─────────────┐  ┌─────────────┐                          │
│  │   STARTER   │  │UNAUTHORIZED │                          │
│  │             │  │             │                          │
│  │ • Vote on   │  │ • View Menu │                          │
│  │   Items     │  │ • Make      │                          │
│  │ • View      │  │   Purchase  │                          │
│  │   Orders    │  │ • Get       │                          │
│  │ • Manage    │  │   Tokens    │                          │
│  │   Account   │  │             │                          │
│  └─────────────┘  └─────────────┘                          │
└─────────────────────────────────────────────────────────────┘
```

## Токеномика

### Security Tokens
- **Выдача**: 1:1 к сумме покупки
- **Функции**: 
  - Определение роли пользователя
  - Право на майнинг блоков
  - Участие в управлении системой

### Utility Tokens
- **Выдача**: 10% от суммы покупки
- **Функции**:
  - Голосование за новые блюда
  - Влияние на развитие меню

### Роли по токенам
- **Main Owner**: Специальная роль
- **Big Stack**: >10% от общего количества
- **Middle Player**: 5-10% от общего количества
- **Starter**: 1-5% от общего количества
- **Unauthorized**: <1% от общего количества

## Безопасность

### Валидация
- Проверка прав доступа для каждой операции
- Валидация входных данных
- Проверка балансов токенов

### Блокчейн
- Proof of Stake консенсус
- Хеширование для целостности данных
- Цепочка блоков для аудита

### API
- JSON валидация
- Обработка ошибок
- Логирование операций
